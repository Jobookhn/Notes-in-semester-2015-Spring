#1.2 Memory in Embedded Systems
##一、存储器
* 无声的革命
* 存储空间的发展
* 寻址的发展
###1.存储的定义
####硬件设计师
* 保存数据
* RAM与ROM
* 动态/静态
####软件工程师
* 保存代码和数据
* 运行程序的空间
####嵌入式系统设计师
* RAM/ROM
####C编译器设计师
* 数据区
* 代码区
* 堆栈
* I/O设备
* ……
###2.可固化代码
* 可固化性
* 代码和数据必须分开  
除非是常量数据
##二、程序段
* 对存储器单元命名
* 由链接器完成此工作
###1.静态变量
* 不在栈和寄存器中
* 可初始化，不指定时0为默认值
* 内存中的随机值可能产生问题
####解决的方式
* 显式地初始化
* 保存在ROM中  
将其看作一种常量
* 保存在ROM中，但将其在启动时复制到RAM中  
需要提供相应的映射机制
###2.开发工具的分段解决方案
* code
* zerovars
* initvars
* const
* strings
* literals
* tags
##二、存储器体系结构
###1.类型
####平面单一
* 由C提供固有支持
* 地址可以不连续  
存在保证正确访问的机制
* 0空间可能存在问题
####分段
* near and far  
是否在本段中就能完成数据访问
* 段寄存器帮助在更大空间中寻址
####单元切换
* 以小的窗口缓冲区映射到大地址范围的不同位置
* 支持的编译器并不多
####多地址空间
* 将内存存储分为不同的段  
彼此之间界限分明，数据不可交换
* 高级语言需要额外的指示将它们放置在正确的位置中
####虚拟存储
* 严格来说不是存储架构
* 在内存和交换区间实现数据替换
* 嵌入式系统中并不经常使用  
数据延迟会导致实时性问题
###2.Cache
* 提供更好的性能
* 有效的利用可以用于优化
###3.MMU
* 提供存储器保护
* 通常由RTOS管理
####实现方式
* 分块的内存区域
* 进程模型的实现
##三、软件影响硬件设计
###1.硬件的设计者
* 通常是软件和硬件两个团队分别进行软硬件设计  
同时了解两方面知识的人毕竟很少
* 不同的设计方案总会在最终产品中有体现  
**软件设计的介入越早越好**
###2.软硬件的tradeoff
####微处理器的选择
* 影响软件效率
* 软件工具对CPU性能的要求
####存储的大小与搭配
* 尽可能晚地决定  
通常很难在早期对内存的需求做出准确的估计
* 使用可替换的RAM/ROM
####外设的实现
* 可以以软件的方式解决硬件的问题
	* 软件实现会对CPU产生一定负载  
	关注成本，CPU性能又有富余时可以选用
	* 硬件实现
###3.硬件调试
####在线仿真器
最为理想的工具

* 类似于替换的处理器
* 以非侵入的方式进行调试
* 完整地控制CPU的执行序列
* 没有被广泛使用  
成本很高，主频的提高带来更多问题
####基于监控的调试器
在RTOS的框架之下很常用

* 需要通信通道
* 需要ROM/RAM的替换
####片上调试
* CPU需要支持此形式
* 需要目标机与宿主机的连接器  
不仅是物理上的，还有逻辑上的协议
###4.自检的支持
####I/O的电路
回环的功能
####板上开关
通过跳线和开关完成自检的动作
####状态显示
* 字符显示
* LED灯
##四、软件的移植
###1.代码
* C/C++等高级语言易于移植  
*事实上，移植面临工具的变换，编译器的替换可能会带来一些问题*
* 性能的非线性变化
* 汇编语言一定需要重写  
即使是同一厂商同一系列产品，也可能会增加新的特性
###2.数据
####变量
* 数据类型的大小是目标相关的  
对齐的自然边界也可能会有变化
* 枚举类型的变化
####函数
任何依赖函数入栈顺序的函数都是不可移植的
####大/小端的问题
###3.实时性
* 非线性的性能
* 中断的不同实现
	* 尽可能用C编写ISR
	* 中断向量也使用C
###4.RTOS
通常还是习惯使用原有的RTOS，降低成本也减少学习负担

* RTOS增加了移植的复杂性  
RTOS难免包含一些汇编代码
* RTOS需求的变化
	* 良好的工具支持
	* 面向特定应用的能力
	* 更多可用组件
###5.EABI
嵌入式应用二进制接口

* 编译器和调试器可以混用
* 不同编译器产生的代码可以混合使用
* 第三方的二进制库可以任意使用
####强调的内容
#####函数调用习惯
#####寄存器的使用
* 专用寄存器
* 易失性寄存器  
在函数调用之后内容会改变，需要进行现场保护
* 非易失性寄存器
#####栈帧
#####数据类型
* 对齐规则
* 大小端支持  
通常不会混合支持
#####文件格式
* 目标文件：ELF
* 调试信息：DWARF  
Debug With Arbitrary Record Format
	* 不同厂商对其进行了扩展
	* 扩展降低了互操作性